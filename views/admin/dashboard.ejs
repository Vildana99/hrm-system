<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Početna</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/partials.css">
    <link rel="stylesheet" href="/stylesheets/adminDashboard.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<%- include('../partials/navbar.ejs') %>

<!-- Glavni sadržaj -->
<div class="container my-5">
    <div class="content">
        <h1 class="display-4 text-center mb-4">Statistički pregled</h1>

        <!-- Grafikoni -->
        <div class="chart-container">
            <!-- Prikaz grafikona za broj prijava po konkursu -->
            <div class="col">
                <h3>Broj prijava po konkursu</h3>
                <div class="canvas-container">
                    <canvas id="applicationsChart"></canvas>
                </div>
            </div>

            <!-- Prikaz grafikona za status prijava -->
            <div class="col">
                <h3>Status prijava</h3>
                <div class="canvas-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

    </div>
</div>

<%- include('../partials/footer.ejs') %>

<script>
    // Broj prijava
    const applicationsData = <%- JSON.stringify(applications) %>; // Prijave kao JSON string
    const applicationsLabels = applicationsData.map(item => item.job_title); // Nazivi poslova
    const applicationsValues = applicationsData.map(item => item.application_count); // Broj prijava

    const applicationsChartCtx = document.getElementById('applicationsChart').getContext('2d');
    new Chart(applicationsChartCtx, {
        type: 'bar',
        data: {
            labels: applicationsLabels,
            datasets: [{
                label: 'Broj prijava',
                data: applicationsValues,
                backgroundColor: '#8E1616',
                borderColor: '#D84040',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true // Pocetak y-ose od 0
                }
            }
        }
    });

    // Statusi prijava
    const statusData = <%- JSON.stringify(statusCounts) %>; // Statusi prijava
    const statusLabels = statusData.map(item => item.status_name); // Nazivi statusa
    const statusValues = statusData.map(item => item.status_count); // Broj statusa

    const statusChartCtx = document.getElementById('statusChart').getContext('2d');
    new Chart(statusChartCtx, {
        type: 'pie',
        data: {
            labels: statusLabels,
            datasets: [{
                data: statusValues,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#FF5733'],
                hoverOffset: 4 //vizualno naglašava segment na koji korisnik fokusira pažnju., 4px
            }]
        }
    });
</script>

</body>
</html>
